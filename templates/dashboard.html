{% extends 'base.html' %}
{% block content %}

<div class="container-fluid">

    <div class="row">
        <!-- widget #1 -->
        <div class="col-xs-3">
            <div class="panel panel-default widget" id="widget1">
                <div class="panel-body clearfix">
                    <a href="" role="button" title="Edit profile" class="pull-right" data-toggle="modal" data-target="#profileEditModal" id="edit-profile-button"><img src="/static/images/dashboard.png" class="myWidget"></a>
                    <h4>DASHBOARD PROFILE</h4>
                    <img src="/static/images/star.png" style="height: 48px; width: 48px; display: block; opacity: .4" class="pull-left"><h2> {{ name }}</h2>
                </div>
            </div>
        </div>

        <!-- widget #2 -->
        <div class="col-xs-3">
            <div class="panel panel-default widget" id="widget2">
                <div class="panel-body clearfix">
                    <img src="/static/images/contacts.png" class="myWidget pull-right">
                    <h4>TOTAL CONTACTS</h4>
                    <h2>{{ total_contacts }}</h2>
                </div>
            </div>
        </div>

        <!-- widget #3 -->
        <div class="col-xs-3">
            <div class="panel panel-default widget" id="widget3">
                <div class="panel-body clearfix">
                    <img src="/static/images/interaction.png" class="myWidget pull-right">
                    <h4>TOTAL INTERACTIONS</h4>
                    <h2>{{ total_interactions }}</h2>
                </div>
            </div>
        </div>

        <!-- widget #4 -->
        <div class="col-xs-3">
            <div class="panel panel-default widget" id="widget4">
                <div class="panel-body clearfix">
                    <img src="/static/images/party.png" class="myWidget pull-right">
                    <h4>TOTAL FRIENERGY</h4>
                    <h2>{{ total_frienergy }}</h2>
                </div>
            </div>
        </div>

    </div>

    <!-- row #2 -->
    <div class="row">

        <!-- line graph column -->
        <div class="col-xs-8">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4>Total Frienergy by Date</h4>
                </div>
                <div class="panel-body panel-fixed-1">
                    <div class="col-xs-7 text-center">
                        <canvas id="lineGraph"></canvas>
                        <!-- <div id="lineLegend"></div> -->
                    </div>
                </div>
            </div>
        </div>

        <!-- pie chart column -->
        <div class="col-xs-4">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4>Percent of Interaction by Frienergy</h4>
                </div>
                <div class="panel-body panel-fixed-1">
                    <canvas id="pieChart"></canvas>
                    <!-- <div id="pieLegend"></div> -->
                </div>
            </div>
        </div>

    </div>

    <!-- contacts and interactions row-->
    <div class="row">

        <!-- contacts column -->
        <div class="col-xs-5">
            
            <!-- contacts panel -->
            <div class="panel panel-default">
                <div class="panel-heading clearfix">
                    <a href="" role="button" class="pull-right" title="Add contact" data-toggle="modal" data-target="#addContactModal"><img src="/static/images/add_contact.png" style="height: 36px; width: 36px"></a>
                    <h4 class="pull-left">Contacts: </h4>

                </div>
                <div class="panel-body panel-fixed">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Relationship Power</th>
                                <th></th>
                            </tr>
                        </thead>
                        {% if contacts %}
                        <tbody>
                            {% for item in contacts %}
                            <tr class="contact-info">

                                <!-- name is a link to contact page -->
                                <td><a href="/contact/{{ item[3] }}" title="See relationship">{{ item[1] }} {{ item[2] }}</a></td>

                                <td>
                                    <div class="progress">
                                        <div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: {{ item[0] }}%;">
                                        <!-- <span class="sr-only">60% Complete</span> -->
                                        </div>
                                    </div>
                                </td>

                                <!-- button stores contact name and id -->
                                <td>
                                    <a href="" role="button" class="pull-right add-int" data-toggle="modal" data-target="#addInteractionModal" data-name="{{ item[1] }} {{ item[2] }}" data-contact-id="{{ item[3] }}" title="Add interaction"><img src="/static/images/plus.png" style="height: 24px; width: 24px"></a>
                                </td>

                            </tr>
                            {% endfor %}
                        </tbody>
                        {% endif %}
                    </table>
                </div>
            </div>

        </div>

        <!-- interactions column -->
        <div class="col-xs-4">

            <!-- interactions panel -->
            <div class="panel panel-default">
                <div class="panel-heading clearfix">
                    <h4 class="pull-left">Interactions: </h4>
                </div>
                <div class="panel-body panel-fixed">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>With</th>
                                <th>Frienergy</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        {% if interactions %}
                        <tbody>
                            {% for i in interactions %}
                            <tr>
                                <!-- date is a link to edit interaction -->
                                <td><a href="" class="interaction-link" title="Edit interaction" data-toggle="modal" data-target="#editInteractionModal" data-int-id="{{ i[0].interaction_id }}">{{ i[1] }}</a></td>
                                <td>{{ i[0].contact.first_name }} {{ i[0].contact.last_name }}</td>
                                <td>{{ i[0].frienergy }}</td>
                                {% if i[0].note %}
                                <td><a href="" class="note-popover" data-toggle="popover" data-trigger="focus" title="Note" data-placement="top" data-id="{{ i[0].interaction_id }}" tabindex="0" role="button" id="popover-tag"><img src="/static/images/Note.png" alt="Note" height="24" width="24"></a></td>
                                {% endif %}
                            </tr>
                            {% endfor %}
                        </tbody>
                        {% endif %}
                    </table>
                </div>
            </div>

        </div>

        <!-- reminders column -->
        <div class="col-xs-3" ng-controller="MainController">
            
            <!-- reminders panel -->
            <div class="panel panel-default">
                <div class="panel-heading clearfix">
                    
                    <h4 class=" pull-left">Reminders: </h4>

                </div>
                <div class="panel-body panel-fixed">

                    <table class="table" ng-if="reminders != []">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Days Overdue</th>
                            </tr>
                        </thead>

                        <tbody>
                            <tr ng-repeat="r in reminders" class="contact-info reminder-list">
                                <td>{[ r.first_name ]} {[ r.last_name ]}</td>
                                <td>{[ r.days_overdue ]}</td>
                            </tr>
                        </tbody>
                        
                    </table>
                    <div ng-if="reminders == []">
                        <p>You have no reminders.</p>
                    </div>
                </div>
            </div>

        </div>

    </div>

</div>

<!-- Edit Profile Modal -->
<div class="modal fade" id="profileEditModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">

    <div class="modal-dialog modal-lg" role="document">

        <div class="modal-content">

            <!-- modal header -->
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Edit Profile</h4>
                <h5 class="prepopulate" id="user-name"></h5>
            </div>

            <!-- modal body -->
            <div class="modal-body">
                <!-- form -->
                <form action="/editProfile" id="edit-profile-form" class="form-horizontal" method="POST">

                <div class="form-group">
                  <label for="firstName" class="col-sm-2 control-label">First Name</label>
                  <div class="col-sm-10">
                    <input type="text" name="first-name" class="form-control prepopulate" id="first-name">
                  </div>
                </div>

                <div class="form-group">
                  <label for="lastName" class="col-sm-2 control-label">Last Name</label>
                  <div class="col-sm-10">
                    <input type="text" name="last-name" class="form-control prepopulate" id="last-name">
                  </div>
                </div>

                <div class="form-group">
                  <label for="inputEmail" class="col-sm-2 control-label">Email</label>
                  <div class="col-sm-10">
                    <input type="email" name="email" class="form-control prepopulate" id="email">
                  </div>
                </div>

                <div class="form-group">
                  <label for="zipcode" class="col-sm-2 control-label">Zipcode</label>
                  <div class="col-sm-10">
                    <input type="text" name="zipcode" class="form-control prepopulate" id="zipcode" size="5">
                  </div>
                </div>

                <div class="form-group">
                  <label for="inputPassword" class="col-sm-2 control-label" required>New Password</label>
                  <div class="col-sm-10">
                    <input type="password" name="password" class="form-control" id="inputPassword">
                  </div>
                </div>

                <div class="form-group">
                  <label class="col-sm-2 control-label"></label>
                  <div class="col-sm-10">
                    <button type="submit" class="btn btn-primary pull-right">Update Profile</button>
                  </div>
                </div>
              </form>
                
            </div>

        </div>

    </div>

</div>

<!-- Add Contact Modal -->
<div class="modal fade" id="addContactModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">

    <div class="modal-dialog" role="document">

        <div class="modal-content">

            <!-- modal header -->
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Add Contact</h4>
            </div>

            <!-- modal body -->
            <div class="modal-body">

                <!-- form -->
                <form action="/addContact" id="add-contact-form" class="form-horizontal" method="POST">

                <div class="form-group">
                    <label for="first-name" class="col-sm-2 control-label">First Name </label>
                    <div class="col-sm-10">
                        <input type="text" name="first-name" class="form-control" id="first-name" placeholder="First" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="last-name" class="col-sm-2 control-label">Last Name </label>
                    <div class="col-sm-10">
                        <input type="text" name="last-name" class="form-control" id="last-name" placeholder="Last">
                    </div>
                </div>
                <div class="form-group">
                    <label for="contact-email" class="col-sm-2 control-label">Email </label>
                    <div class="col-sm-10">
                        <input type="email" name="contact-email" class="form-control" id="contact-email" placeholder="email@domain.com">
                    </div>
                </div>
                <div class="form-group">
                    <label for="cell-phone" class="col-sm-2 control-label">Cell Phone </label>
                    <div class="col-sm-10">
                        <input type="text" name="cell-phone" class="form-control" id="cell-phone" placeholder="415-555-1234">
                    </div>
                </div>
                <div class="form-group">
                    <label for="street" class="col-sm-2 control-label">Street </label>
                    <div class="col-sm-10">
                        <input type="text" name="street" class="form-control" id="street" placeholder="1234 Main St. #567">
                    </div>
                </div>
                <div class="form-group">
                    <label for="city" class="col-sm-2 control-label">City </label>
                    <div class="col-sm-10">
                        <input type="text" name="city" class="form-control" id="city" placeholder="Redwood City">
                    </div>
                </div>
                <div class="form-group">
                    <label for="state" class="col-sm-2 control-label">State </label>
                    <div class="col-sm-10">
                        <input type="text" name="state" class="form-control" id="state" placeholder="CA">
                    </div>
                </div>
                <div class="form-group">
                    <label for="zipcode" class="col-sm-2 control-label">Zipcode </label>
                    <div class="col-sm-10">
                        <input type="text" name="zipcode" class="form-control" id="zipcode" placeholder="94062">
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-2 control-label"></label>
                    <div class="col-sm-10">
                        <button type="submit" class="btn btn-primary pull-right">Add</button>
                    </div>
                </div>

                </form>

            </div>

        </div>

    </div>

</div>

<!-- Add Interaction Modal -->
<div class="modal fade" id="addInteractionModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">

    <div class="modal-dialog" role="document">

        <div class="modal-content">

            <!-- modal header -->
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Add Interaction</h4>
                <h5 id="contact-name-for-form"></h5>
            </div>

            <!-- modal body -->
            <div class="modal-body">

                <!-- form -->
                <form action="/addInteraction" id="add-interaction-form" class="form-horizontal" method="POST">
                <div class="form-group">
                    <input type="hidden" name="contact-id" id="contact-id">
                </div>
                <div class="form-group">
                    <label for="date" class="col-sm-2 control-label">Date </label>
                    <div class="col-sm-10">
                        <input type="date" name="date" class="form-control" id="date">
                    </div>
                </div>
                <div class="form-group">
                    <label for="frienergy" class="col-sm-2 control-label">Frienergy </label>
                    <div class="col-sm-10">
                        <input type="number" name="frienergy" class="form-control" id="frienergy" min="1" max="10">
                    </div>
                </div>
                <div class="form-group">
                    <label for="notes" class="col-sm-2 control-label">Notes </label>
                    <div class="col-sm-10">
                        <input type="textarea" name="notes" class="form-control" id="notes" rows="2">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label"></label>
                    <div class="col-sm-10">
                        <button type="submit" class="btn btn-primary pull-right" id="add-int-submit">Add</button>
                    </div>
                </div>
                </form>

            </div>

        </div>

    </div>

</div>

<!-- Edit Interaction Modal -->
<div class="modal fade" id="editInteractionModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">

    <div class="modal-dialog" role="document">

        <div class="modal-content">

            <!-- modal header -->
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Edit Interaction</h4>
                <h5 id="prepopulate-contact-name" class="pull-left"></h5>
            </div>

            <!-- modal body -->
            <div class="modal-body">

                <!-- form -->
                <form action="/editInteraction" id="edit-interaction-form" class="form-horizontal" method="POST">
                <div class="form-group">
                    <input type="hidden" id="prepopulate-int-id" name="interaction-id">
                    <input type="hidden" id="prepopulate-note-id" name="note-id">
                </div>
                <div class="form-group">
                    <label for="date" class="col-sm-2 control-label">Date </label>
                    <div class="col-sm-10">
                        <input type="date" id="prepopulate-date" name="date" class="form-control">
                    </div>
                </div>
                <div class="form-group">
                    <label for="frienergy" class="col-sm-2 control-label">Frienergy </label>
                    <div class="col-sm-10">
                        <input type="number" id="prepopulate-frienergy" name="frienergy" class="form-control" min="1" max="10">
                    </div>
                </div>
                <div class="form-group">
                    <label for="notes" class="col-sm-2 control-label">Notes </label>
                    <div class="col-sm-10">
                        <input type="textarea" id="prepopulate-note" name="notes" class="form-control" rows="2">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label"></label>
                    <div class="col-sm-10">
                        <button type="submit" class="btn btn-danger col-sm-offset-4" formaction="/deleteInteraction">Delete Interaction</button>
                        <button type="submit" class="btn btn-primary pull-right">Update Interaction</button>
                    </div>
                </div>

                </form>

            </div>

        </div>

    </div>

</div>

{% endblock %}